<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>Metrics Widget â€“ Dev Example</title>
    <link rel="stylesheet" href="./widget.css" />
  </head>

  <body>
    <main>
      <h1>Metrics Widget (local dev)</h1>
      <p>This page mirrors the example embed used in the docs.</p>
      <div id="metrics-widget"></div>
    </main>

    <!-- Widget configuration -->
    <script type="application/json" id="operas-metrics-config">
      {
        "settings": {
          "locale": "en",
          "citations_url": "https://metrics-api.operas-eu.org/citations"
        },
        "options": {
          "hide_initial_loading_screen": true
        },
        "tabs": [
          {
            "id": "overview",
            "name": "Overview",
            "order": 1,
            "scopes": {
              "sessions": {
                "title": "Sessions",
                "works": ["info:doi:10.5334/bbc"],
                "measures": ["up-logs/sessions"]
              }
            },
            "graphs": [
              {
                "id": "sessions_line",
                "type": "line",
                "title": "Sessions over time",
                "scopes": ["sessions"],
                "config": { "stacked": false, "begin_at_zero": true }
              },
              {
                "id": "sessions_map",
                "type": "world_map",
                "scopes": ["sessions"],
                "options": { "width": 50 }
              },
              {
                "id": "sessions_countries",
                "type": "country_table",
                "scopes": ["sessions"],
                "options": { "width": 50 }
              }
            ]
          },
          {
            "id": "citations",
            "name": "Citations",
            "order": 2,
            "scopes": {
              "citations_scope": {
                "title": "Citations",
                "works": ["info:doi:10.5334/bbc"],
                "measures": ["crossref/citations"]
              }
            },
            "graphs": [
              {
                "id": "citations_trend",
                "type": "line",
                "title": "Citations over time",
                "scopes": ["citations_scope"],
                "config": {
                  "stacked": false,
                  "begin_at_zero": true
                }
              },
              {
                "id": "citations_list",
                "type": "citations",
                "scopes": ["citations_scope"],
                "config": {
                  "page_size": 5,
                  "view_all_url": "https://search.crossref.org/search/works?q=10.5334%2Fbbc&from_ui=yes",
                  "show_inline_title": true
                }
              }
            ]
          }
        ]
      }
    </script>

    <!-- Local (unminified) embed for dev -->
    <script>
      window.operaswidget = (id => {
        if (document.getElementById(id)) return widget;

        const script = document.createElement('script');
        script.id = id;
        script.src = './widget.js';
        document.body.appendChild(script);

        const widget = window.operaswidget || {};
        widget.eventQueue = [];
        widget.ready = f => {
          widget.eventQueue.push(f);
        };
        return widget;
      })('operas-metrics');
    </script>

    <!-- Simple event logging -->
    <script>
      operaswidget.ready(w => {
        w.events.on('widget_ready', tabs => {
          console.log('widget ready', tabs);
        });
        w.events.on('graph_ready', graph => {
          console.log('graph ready', graph.id);
        });
      });
    </script>

    <!-- Testing styles only -->
    <style>
      #metrics-widget {
        --color-primary: #506cd3;
        --color-primary-light: #edf0fb;
        --color-primary-dark: #506bd3;
        --color-line-graph-1: #506cd3;
        --color-line-graph-2: #f5a623;
        --color-world-map: #dbe1f6;
        --color-world-map-dark: #899de2;
      }
      body {
        margin: 0;
        padding: 20px;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
          Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      }
      a {
        color: #506cd3;
      }
      main {
        max-width: 960px;
        margin: 0 auto;
      }
    </style>
  </body>
</html>
